# GHOST 프레임워크

> **Generated Human-like Orchestrated Stress Test**

## GHOST의 본질

**wiiiv의 품질을 인간 수준 자연스러움까지 끌어올리는 적대적 대화 시뮬레이터**

### 기존 HST와의 결정적 차이

| 구분 | HST | GHOST |
|---|---|---|
| 사람 역할 | 대본 낭독 | **즉흥 연기** |
| 목적 | "이 경로가 작동하는가" | **"인간이 쓰면 어떻게 되는가"** |
| 난이도 | 설계자가 통제 | **LLM이 스스로 가혹하게** |
| 실패 시 | 테스트 스크립트 수정 | **엔진 수정** |
| 반복 | 같은 메시지 재실행 | **매번 다른 대화, 같은 목표** |

### 핵심 원칙

1. **wiiiv는 상대가 LLM인 줄 모른다** — 진짜 사용자 경험을 시뮬레이션
2. **인간의 불완전함을 재현한다** — 오타, 모호한 지시, 갑자기 주제 변경, "아 그거 아니고", 중간에 딴소리
3. **간단한 건 의미 없다** — 복잡하고 모호하고 가혹한 시나리오만 가치가 있다
4. **매 실행이 개선 루프다** — GHOST 실행 → 엔진 버그 발견 → 수정 → 커밋/푸시 → 다른 시나리오 → 반복
5. **궁극 목표는 "어색함 제로"** — 인간이 일상 업무에서 하는 모든 작업을 wiiiv와 함께 할 때, 부자연스러운 순간이 단 한 번도 없는 상태

### 도달점

GHOST를 통과한 wiiiv는 — 사용자가 "아 이거 AI랑 대화하는 거구나"라고 느끼는 순간이 없어야 합니다. 실수해도 자연스럽게 받아주고, 모호해도 올바르게 물어보고, 급하면 빠르게 처리하고, 복잡하면 체계적으로 정리하는 — **업무 파트너**.

---

## 케이스 형식

기존 HST: `Turn[]` 배열 (메시지 하드코딩)
GHOST: **시나리오 문서** (목표 + 제약 + 페르소나만)

### 예시: PX-C03

```
PX-C03: 김현수 팀장의 긴급 야근
- 페르소나: 급하고 짜증남, 오타 많음, 중간에 딴소리
- 목표: skystock CRITICAL 알림 → 공급사 확인 → 긴급 발주 워크플로우
- 제약: 반드시 cancel 1회 이상, 인증정보를 처음에 안 줌
- 턴 규모: 30~40
- 판정: 워크플로우 실행 성공 + 저장 완료
```

매 실행마다 **다른 대화**를 하되 같은 목표를 달성하므로, 비결정적 테스트가 됩니다.

---

## 구현: ghost-runner.py

기존 `hst-runner.py`는 그대로 둡니다 (회귀 테스트용). `ghost-runner.py`를 새로 만듭니다. 구조가 근본적으로 다릅니다:

```
ghost-runner.py
  → 시나리오 읽기
  → wiiiv 세션 생성
  → [루프] 서버 응답 읽기 → Claude가 다음 메시지 생성 → SSE 전송
  → 목표 달성 판정
  → 결과 기록
```

"Claude가 다음 메시지 생성"은 직접이 아니라, **ghost-runner.py 안에서 LLM API를 호출**합니다. 그래야 `고스트돌려` 한마디에 자동으로 돌아갑니다.

---

## 디렉토리 구조

```
wiiiv/ghost/
├── ghost.md           ← 이 문서 (GHOST 사양서)
├── cases/             ← 시나리오 문서들 (PX-C01.md, PX-C02.md, ...)
├── results/           ← 실행 결과 로그
└── ghost-runner.py    ← GHOST 실행기
```

---

## 수렴 조건

**케이스가 첫 실행에 무수정 PASS → 그 영역은 안정화된 것**

처음에는 매 케이스마다 엔진 버그가 터지고 수정이 많지만, 회차가 쌓이면 점점 수정 없이 통과하는 비율이 높아집니다. **무수정 PASS가 당연해지는 상태**가 GHOST의 도달점입니다.

---

## Phase Y — 극강 난이도 10케이스

### 배경

GX-C01~C20 (20케이스, 21건 버그 수정, C07 이후 14연속 무수정 PASS)로 기본 엔진이 안정화되었다. 하지만 다음 영역은 미검증:
- **PROJECT_CREATE** (코드 생성 파이프라인) — GHOST에서 한 번도 안 씀
- **30턴+ 장기 대화** — 메모리 압축, 컨텍스트 소실
- **취소/재시작** — cancelCurrentTask, 상태 복원
- **동시 다중 태스크** — 한 메시지에 복수 작업
- **적대적 사용자** — 모순, 오정보, 혼란 유도
- **실패 후 복구** — 에러 발생 후 수정/재실행

Phase Y는 이 전부를 10개 케이스로 커버한다.

### 10개 케이스

| ID | 이름 | 파이프라인 | 난이도 | max_turns |
|----|------|-----------|--------|-----------|
| GX-Y01 | 박이사의 풀스택 백엔드 생성 | PROJECT_CREATE | ★★★★★ | 35 |
| GX-Y02 | 장차장의 요구사항 변경 폭탄 | PROJECT_CREATE + 전면 변경 | ★★★★★ | 40 |
| GX-Y03 | 한부장의 풀코스 여정 | PROJECT_CREATE → WORKFLOW_CREATE | ★★★★★ | 40 |
| GX-Y04 | 최실장의 10노드 크로스시스템 WF | WORKFLOW_CREATE (대규모) | ★★★★★ | 30 |
| GX-Y05 | 양과장의 에러 복구 워크플로우 | WORKFLOW_CREATE + 에러 복구 | ★★★★ | 30 |
| GX-Y06 | 김대리의 30턴 마라톤 | API + FILE (5단계, 30턴+) | ★★★★★ | 35 |
| GX-Y07 | 조차장의 적대적 모순 공격 | 적대적 (3회 전환 + 취소) | ★★★★★ | 25 |
| GX-Y08 | 민팀장의 동시 작업 요청 | 복수 작업 동시 요청 | ★★★★ | 20 |
| GX-Y09 | 서인턴의 삽질 대모험 | 적대적 (전정보 오류) | ★★★★ | 20 |
| GX-Y10 | 강전무의 완전 자율 통합 시험 | 종합 (API+FILE+WF_CREATE) | ★★★★★ | 35 |

### 난이도 분포

| 영역 | 케이스 | 개수 |
|------|--------|------|
| PROJECT_CREATE | Y01, Y02, Y03 | 3개 |
| WORKFLOW_CREATE | Y04, Y05 | 2개 |
| 일반 극한 (장기/적대적/동시/오류) | Y06, Y07, Y08, Y09 | 4개 |
| 종합 | Y10 | 1개 |

### 실행 순서

Y01 → Y04 → Y06 → Y09 → Y07 → Y08 → Y05 → Y02 → Y03 → Y10

이유: Y01(PROJECT_CREATE 기반)이 통과해야 Y02/Y03이 의미 있고, Y04(WORKFLOW_CREATE 대규모)가 통과해야 Y05/Y10이 의미 있다. 중간에 일반 극한(Y06~Y09)으로 기본 안정성 확인.

### 검증 절차

1. `python3 ghost-runner.py --case GX-Y01` — 순서대로 실행
2. 각 케이스 FAIL 시 버그 분석 → 엔진 수정 → `./gradlew assemble` → 서버 재시작 → 재실행
3. ghost-findings.md에 Phase Y 결과 추가
