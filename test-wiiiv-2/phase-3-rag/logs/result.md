# Phase 3 결과 — RAG 통합 (Knowledge Augmentation)

> 실행일: 2026-02-21
> 서버: localhost:8235 (LLM: gpt-4o-mini, RAG: InMemoryVectorStore)
> 문서: samsung_realloss.pdf (삼성화재 실손의료비보험 약관, 493 chunks)

## 총괄

| 결과 | 수 |
|------|---|
| **PASS** | 7 |
| **SOFT FAIL** | 1 |
| **HARD FAIL** | 0 |

---

## 사전 준비

- PDF 주입: `POST /api/v2/rag/ingest/file` → 성공 (493 chunks)
- RAG 크기 확인: `GET /api/v2/rag/size` → 493
- RAG 컨텍스트: 매 턴 ~2,500자 주입 확인 (서버 로그)

---

## Case 1: RAG 주입 확인 — **PASS**
- REPLY ✅
- 보험 관련 문서 내용 언급 ✅ (사망 관련 서류, 재해사고 입증 서류, 의료 서류 등)

## Case 2: 직접적 사실 추출 — **PASS**
- REPLY ✅
- **정확한 상품명**: "무배당 삼성화재 다이렉트 실손의료비보험" ✅
- 삼성화재 언급 ✅

## Case 3: 조건부 사실 추출 — **PASS**
- REPLY ✅
- **구체적 금액**: 5,000만원→20만원, 3,000만원→15만원, 1,000만원→10만원 ✅
- 비급여 통원 연간 100회 한도 ✅

## Case 4: 복합 추론 — **SOFT FAIL**
- Turn 1: REPLY ✅ — 입원/통원 한도 각각 제시
- Turn 2: REPLY ✅ — 그러나 정확한 총액 산출 없이 "정확한 금액을 결정하기 위해서는..." 조건부 답변
- **이슈**: 구체적 계산 능력 약함 (gpt-4o-mini 한계)
- 세션 컨텍스트 유지는 정상 ✅

## Case 5: 면책 조항 — **PASS**
- Turn 1: REPLY ✅ — 면책사항 목록 제시
- Turn 2: REPLY ✅ — "보장이 되지 않습니다" 명확 판단
- 부정적 조건(~하지 않는 경우) 이해 정확 ✅

## Case 6: 정직한 "모름" — **PASS**
- REPLY ✅
- "제공된 문서에는 2025년 3분기 손해율에 대한 구체적인 내용이 포함되어 있지 않아 확인할 수 없습니다" ✅
- **환각(hallucination) 없음** ✅ — RAG 시스템의 가장 중요한 품질 지표 통과

## Case 7: 멀티턴 보험 상담 — **PASS**
- 5턴 전부 REPLY ✅, 실행 시도 없음 ✅
- Turn 2: MRI 공제금액(3만원 or 30%), 보상한도(300만원) 정확 인용 ✅
- Turn 3: MRI 보험 청구 가능 여부 약관 기반 판단 ✅
- Turn 4: 필요 서류 7종 구체 나열 (보험금청구서, 통장사본, 진료비 계산서 등) ✅
- Turn 5: 자기부담금/한도 초과 설명 ✅
- **RAG 문맥 + 대화 문맥 모두 유지** ✅

## Case 8: RAG + 일반 지식 교차 — **PASS**
- Turn 1: REPLY ✅ — 제32조(금융소비자보호법) 인용 + 소비자보호법 교차 분석
  - 적합성원칙, 적정성원칙, 설명의무, 불공정 영업행위 금지 언급
- Turn 2: REPLY ✅ — "문서에 포함되어 있지 않습니다" 정직 응답
  - LLM 일반 지식으로 답할 수도 있었으나 RAG 출처에 충실 (보수적이지만 안전)

---

## RAG 파이프라인 품질 평가

| 항목 | 평가 |
|------|------|
| 사실 추출 정확도 | ★★★★★ — 상품명, 금액, 조항번호 정확 |
| 조건부 검색 | ★★★★★ — 통원/입원 분리, MRI 특정 조항 매칭 |
| 복합 추론 | ★★★☆☆ — 사실 나열은 정확하나 수치 계산은 약함 |
| 환각 방지 | ★★★★★ — "모릅니다" 정직 응답 완벽 |
| 컨텍스트 유지 | ★★★★★ — 5턴 연속 상담에서 문맥 유지 |
| 교차 지식 | ★★★★☆ — RAG에 충실하되 일반 지식 활용은 보수적 |

## 서버 로그 확인

- 모든 턴에서 `[RAG] Context injected: ~2,500 chars` 확인
- `[PROMPT] Total length: ~14,000-15,000 chars` (시스템 프롬프트 + RAG 컨텍스트)
- RAG 검색 실패 없음
